{"version":3,"sources":["../../selenium/mofengwoFind.js"],"names":["L","require","Builder","By","Key","until","promise","driver","forBrowser","build","findData","urls","moFengWo","findAll","where","startDate","order","limit","attributes","url","realurl","dataValues","err","seleniumDriver","get","sleep","then","pendingElements","findElements","xpath","elements","map","ele","getText","data","quit","seleniumDriverNew","aaa","console","log","length","obj","outDays","renWu","cost","substring","update"],"mappings":"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","file":"mofengwoFind.js","sourcesContent":["import Model from '../sequelize';\n\nconst L = require('nirvana-logger')('data');\nrequire('chromedriver');\nconst {Builder, By, Key, until, promise} = require('selenium-webdriver');\nlet driver = new Builder().forBrowser('chrome').build();\n\n\nasync function findData() {\n  const urls = await Model.moFengWo.findAll({where: {startDate: ''}, order: ['url'], limit: 100, attributes: ['url']});\n  for (let url of urls) {\n    let realurl = url.dataValues.url;\n    try {\n      L('realUrl', realurl);\n      // await seleniumDriverNew(realurl);\n    } catch (err) {\n    }\n  }\n  L('done');\n}\n\n\nfunction seleniumDriver(url) {\n  driver.get('http://www.mafengwo.cn' + url);\n  // driver.findElement(By.id('kw')).sendKeys('美女', Key.RETURN);\n  driver.sleep(1000).then(function() {\n    let pendingElements = driver.findElements(By.xpath('//div[contains(@class, \"tarvel_dir_list\")]/ul/li'));\n    pendingElements.then(function(elements) {\n      elements.map(ele => {\n        ele.getText().then(function(data) {\n          L('11111', data);\n          // return data;\n        });\n      });\n    }).then(function(data) {\n      L('data', data);\n    });\n  });\n\n  driver.quit();\n}\n\nasync function seleniumDriverNew(url) {\n  L('realUrl', 11);\n  await driver.get('http://www.mafengwo.cn' + url);\n  await driver.sleep(1000);\n  L('realUrl', 22);\n  const aaa = await driver.findElements(By.xpath('//div[contains(@class, \"tarvel_dir_list\")]/ul/li'));\n  L('begin');\n  try {\n    console.log(aaa.length);\n    // L('update', await aaa[0].getText());\n    let obj = {};\n    if (aaa.length === 0) {\n      obj.startDate = '';\n      obj.outDays = '';\n      obj.renWu = '';\n      obj.cost = '2222';\n    } else {\n      obj.startDate = (await aaa[0].getText() || '').substring(5);\n      obj.outDays = (await aaa[1].getText() || '').substring(5);\n      obj.renWu = (await aaa[2].getText() || '').substring(3);\n      obj.cost = '1111';\n      if (aaa.length > 3) {\n        obj.cost = (await aaa[3].getText()).substring(5);\n      }\n    }\n\n    L('update', obj);\n    await Model.moFengWo.update(obj, {where: {url}});\n  } catch (err) {\n    console.log(err);\n  }\n\n  driver.quit();\n}\n\n\nfindData();\n"]}