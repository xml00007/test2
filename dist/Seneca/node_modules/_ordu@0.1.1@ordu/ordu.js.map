{"version":3,"sources":["../../../../Seneca/node_modules/_ordu@0.1.1@ordu/ordu.js"],"names":["Assert","require","module","exports","opts","Ordu","orduI","self","name","add","api_add","process","api_process","tasknames","api_tasknames","taskdetails","api_taskdetails","toString","api_toString","tasks","spec","task","Object","defineProperty","value","length","tags","push","i","arguments","data","ctxt","tI","contains","index$","taskname$","res","ctxt$","data$","map","v","all","some","indexOf"],"mappings":"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","file":"ordu.js","sourcesContent":["/* Copyright (c) 2016 Richard Rodger and other contributors, MIT License */\n'use strict'\n\n\nvar Assert = require('assert')\n\n\nmodule.exports = function (opts) {\n  return new Ordu(opts)\n}\n\n\nvar orduI = -1\n\n\nfunction Ordu (opts) {\n  var self = this\n  ++orduI\n\n\n  opts = opts || {}\n  Assert('object' === typeof opts)\n\n  opts.name = opts.name || 'ordu' + orduI\n\n\n  self.add = api_add\n  self.process = api_process\n  self.tasknames = api_tasknames\n  self.taskdetails = api_taskdetails\n  self.toString = api_toString\n\n\n  var tasks = []\n\n\n  function api_add (spec, task) {\n    task = task || spec\n\n    Assert('function' === typeof task)\n\n    if (!task.name) {\n      Object.defineProperty(task, 'name', {\n        value: opts.name + '_task' + tasks.length\n      })\n    }\n\n    task.tags = spec.tags || []\n\n    tasks.push(task)\n\n    return self\n  }\n\n\n  // Valid calls:\n  //   * process(spec, ctxt, data)\n  //   * process(ctxt, data)\n  //   * process(data)\n  //   * process()\n  function api_process () {\n    var i = arguments.length\n    var data = 0 < i && arguments[--i]\n    var ctxt = 0 < i && arguments[--i]\n    var spec = 0 < i && arguments[--i]\n\n    data = data || {}\n    ctxt = ctxt || {}\n    spec = spec || {}\n\n    spec.tags = spec.tags || []\n\n    for (var tI = 0; tI < tasks.length; ++tI) {\n      var task = tasks[tI]\n\n      if (0 < spec.tags.length && !contains(task.tags, spec.tags)) {\n        continue\n      }\n\n      var index$ = tI\n      var taskname$ = task.name\n\n      ctxt.index$ = index$\n      ctxt.taskname$ = taskname$\n\n      var res = task(ctxt, data)\n\n      if (res) {\n        res.index$ = index$\n        res.taskname$ = taskname$\n        res.ctxt$ = ctxt\n        res.data$ = data\n        return res\n      }\n    }\n\n    return null\n  }\n\n\n  function api_tasknames () {\n    return tasks.map(function (v) {\n      return v.name\n    })\n  }\n\n\n  function api_taskdetails () {\n    return tasks.map(function (v) {\n      return v.name + ':{tags:' + v.tags + '}'\n    })\n  }\n\n\n  function api_toString () {\n    return opts.name + ':[' + self.tasknames() + ']'\n  }\n\n  return self\n}\n\n\nfunction contains (all, some) {\n  for (var i = 0; i < some.length; ++i) {\n    if (-1 === all.indexOf(some[i])) {\n      return false\n    }\n  }\n\n  return true\n}\n"]}